# 基于TCP的服务端与客户端（2）

## 回声客户端的完美实现

1. 客户端接收数据时，应确定接收的数据大小；

2. 或者，可以在应用层协议上定义数据边界，接收到数据边界就停止；

## TCP原理

1. TCP套接字中的I/O缓冲：

 - TCP套接字中的I/O缓冲：
 ![TCP套接字中的I/O缓冲](TCP套接字中的IO缓冲.png)
 
 - I/O缓冲的特性：
 ![IO缓冲的特性](IO缓冲的特性.png)
 
 - TCP数据传输不会发生超过输入缓冲大小的数据传输：
 ![TCP对数据流的控制](TCP对数据流的控制.png)
 
 - write函数返回的时间点:
 ![write函数返回的时间点](write函数返回的时间点.png)
 
2. TCP的连接建立：

 - 三次握手：
 ![三次握手](三次握手.png)
 
 - 与对方主机的数据交换
 ![TCP套接字的数据交换过程](TCP套接字的数据交换过程.png)
 > ACK号 = SEQ号 + 传递的字节数 + 1（加1是为了告知对方下次要传递的SEQ号）
 
 - 传输过程中数据包消失的情况
 ![超时重传](超时重传.png)
 
3. 断开与套接字的连接：

 - 四次挥手：
 ![四次挥手](四次挥手.png)
 
 
 